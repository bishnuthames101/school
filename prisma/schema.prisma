generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// === Multi-Tenant: School (tenant root) ===

model School {
  id        String   @id @default(cuid())
  slug      String   @unique // matches SCHOOL_ID env var: "kopess", "schoolb"
  name      String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  admins        Admin[]
  events        Event[]
  notices       Notice[]
  galleryImages GalleryImage[]
  popups        Popup[]
  applications  ApplicationForm[]
  contacts      ContactForm[]

  @@map("schools")
}

// === Admin ===

model Admin {
  id        String   @id @default(cuid())
  username  String
  password  String
  schoolId  String
  school    School   @relation(fields: [schoolId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([username, schoolId])
  @@map("admins")
}

// === Application Form (Nepal-standard) ===

model ApplicationForm {
  id       String @id @default(cuid())
  schoolId String
  school   School @relation(fields: [schoolId], references: [id])

  // --- Student Info ---
  studentNameEn String
  studentNameNp String?
  dobAD         DateTime
  dobBS         String?
  gender        String
  nationality   String  @default("Nepali")
  gradeApplying String
  photo         String?

  // --- Father Info ---
  fatherName       String
  fatherPhone      String
  fatherOccupation String?

  // --- Mother Info ---
  motherName       String
  motherPhone      String?
  motherOccupation String?

  // --- Address (Nepal structure) ---
  province     String
  district     String
  municipality String
  wardNo       String
  tole         String?

  // --- Previous School ---
  previousSchool String?
  previousClass  String?

  // --- Contact ---
  email String
  phone String

  // --- Meta ---
  message   String?  @db.Text
  status    String   @default("pending") // pending | reviewed | accepted | rejected
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("application_forms")
}

// === Contact Form ===

model ContactForm {
  id        String   @id @default(cuid())
  schoolId  String
  school    School   @relation(fields: [schoolId], references: [id])
  name      String
  email     String
  phone     String
  subject   String
  message   String   @db.Text
  status    String   @default("unread") // unread | read | replied
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("contact_forms")
}

// === Event ===

model Event {
  id          String   @id @default(cuid())
  schoolId    String
  school      School   @relation(fields: [schoolId], references: [id])
  title       String
  date        String
  category    String   @default("Other")
  image       String?
  description String?  @db.Text
  highlights  String[] @default([])
  photos      String[] @default([])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("events")
}

// === Gallery Image ===

model GalleryImage {
  id        String   @id @default(cuid())
  schoolId  String
  school    School   @relation(fields: [schoolId], references: [id])
  imageUrl  String
  caption   String?
  category  String   @default("Other")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("gallery_images")
}

// === Notice ===

model Notice {
  id          String   @id @default(cuid())
  schoolId    String
  school      School   @relation(fields: [schoolId], references: [id])
  title       String
  date        String
  category    String   @default("General")
  description String?  @db.Text
  priority    String   @default("normal")
  attachment  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("notices")
}

// === Popup ===

model Popup {
  id        String    @id @default(cuid())
  schoolId  String
  school    School    @relation(fields: [schoolId], references: [id])
  title     String
  imageUrl  String?
  linkUrl   String?
  startDate DateTime?
  endDate   DateTime?
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("popups")
}
